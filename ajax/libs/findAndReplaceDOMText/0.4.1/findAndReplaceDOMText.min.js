window.findAndReplaceDOMText=function(){var n="retain",d="first",I=document;function s(){return function(e,t,n,r,i){if(t&&!t.nodeType&&arguments.length<=2)return!1;var d="function"==typeof n;d&&(o=n,n=function(e,t){return o(e.text,t.startIndex)});var o;var a=h(t,{find:e,wrap:d?null:n,replace:d?n:"$"+(r||"&"),prepMatch:function(e,t){if(!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";if(0<r){var n=e[r];e.index+=e[0].indexOf(n),e[0]=n}return e.endIndex=e.index+e[0].length,e.startIndex=e.index,e.index=t,e},filterElements:i});return s.revert=function(){return a.revert()},!0}.apply(null,arguments)||h.apply(null,arguments)}function h(e,t){return new r(e,t)}function r(e,t){t.portionMode=t.portionMode||n,this.node=e,this.options=t,this.prepMatch=t.prepMatch||this.prepMatch,this.reverts=[],this.matches=this.search(),this.matches.length&&this.processMatches()}return(s.Finder=r).prototype={search:function(){var e,t=0,n=this.options.find,r=this.getAggregateText(),i=[];if((n="string"==typeof n?RegExp(String(n).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1"),"g"):n).global)for(;e=n.exec(r);)i.push(this.prepMatch(e,t++));else(e=r.match(n))&&i.push(this.prepMatch(e,0));return i},prepMatch:function(e,t){if(!e[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");return e.endIndex=e.index+e[0].length,e.startIndex=e.index,e.index=t,e},getAggregateText:function(){var r=this.options.filterElements;return function e(t){if(3===t.nodeType)return t.data;if(r&&!r(t))return"";var n="";if(t=t.firstChild)for(;n+=e(t),t=t.nextSibling;);return n}(this.node)},processMatches:function(){var e,t,n,r=this.matches,i=this.node,d=this.options.filterElements,o=[],a=i,s=r.shift(),h=0,p=0;e:for(;;){if(3===a.nodeType&&(!t&&a.length+h>=s.endIndex?t={node:a,index:p++,text:a.data.substring(s.startIndex-h,s.endIndex-h),indexInMatch:h-s.startIndex,indexInNode:s.startIndex-h,endIndexInNode:s.endIndex-h,isEnd:!0}:e&&o.push({node:a,index:p++,text:a.data,indexInMatch:h-s.startIndex,indexInNode:0}),!e&&a.length+h>s.startIndex&&(e={node:a,index:p++,indexInMatch:0,indexInNode:s.startIndex-h,endIndexInNode:s.endIndex-h,text:a.data.substring(s.startIndex-h,s.endIndex-h)}),h+=a.data.length),n=1===a.nodeType&&d&&!d(a),e&&t){if(a=this.replaceMatch(s,e,o,t),h-=t.node.data.length-t.endIndexInNode,t=e=null,o=[],p=0,0,!(s=r.shift()))break}else if(!n&&(a.firstChild||a.nextSibling)){a=a.firstChild||a.nextSibling;continue}for(;;){if(a.nextSibling){a=a.nextSibling;break}if(a.parentNode===i)break e;a=a.parentNode}}},revert:function(){for(var e=this.reverts.length;e--;)this.reverts[e]();this.reverts=[]},prepareReplacementString:function(e,t,r,n){var i=this.options.portionMode;return i===d&&0<t.indexInMatch?"":(e=e.replace(/\$(\d+|&|`|')/g,function(e,t){var n;switch(t){case"&":n=r[0];break;case"`":n=r.input.substring(0,r.startIndex);break;case"'":n=r.input.substring(r.endIndex);break;default:n=r[+t]}return n}),i===d?e:t.isEnd?e.substring(t.indexInMatch):e.substring(t.indexInMatch,t.indexInMatch+t.text.length))},getPortionReplacementNode:function(e,t,n){var r=this.options.replace||"$&",i=this.options.wrap;if(i&&i.nodeType){var d=I.createElement("div");d.innerHTML=i.outerHTML||(new XMLSerializer).serializeToString(i),i=d.firstChild}if("function"==typeof r)return(r=r(e,t,n))&&r.nodeType?r:I.createTextNode(String(r));var o="string"==typeof i?I.createElement(i):i;return(r=I.createTextNode(this.prepareReplacementString(r,e,t,n))).data&&o?(o.appendChild(r),o):r},replaceMatch:function(e,t,n,r){var i,d,o=t.node,a=r.node;if(o===a){var s=o;0<t.indexInNode&&(i=I.createTextNode(s.data.substring(0,t.indexInNode)),s.parentNode.insertBefore(i,s));var h=this.getPortionReplacementNode(r,e);return s.parentNode.insertBefore(h,s),r.endIndexInNode<s.length&&(d=I.createTextNode(s.data.substring(r.endIndexInNode)),s.parentNode.insertBefore(d,s)),s.parentNode.removeChild(s),this.reverts.push(function(){i===h.previousSibling&&i.parentNode.removeChild(i),d===h.nextSibling&&d.parentNode.removeChild(d),h.parentNode.replaceChild(s,h)}),h}i=I.createTextNode(o.data.substring(0,t.indexInNode)),d=I.createTextNode(a.data.substring(r.endIndexInNode));for(var p=this.getPortionReplacementNode(t,e),c=[],l=0,f=n.length;l<f;++l){var u=n[l],x=this.getPortionReplacementNode(u,e);u.node.parentNode.replaceChild(x,u.node),this.reverts.push(function(e,t){return function(){t.parentNode.replaceChild(e.node,t)}}(u,x)),c.push(x)}var g=this.getPortionReplacementNode(r,e);return o.parentNode.insertBefore(i,o),o.parentNode.insertBefore(p,o),o.parentNode.removeChild(o),a.parentNode.insertBefore(g,a),a.parentNode.insertBefore(d,a),a.parentNode.removeChild(a),this.reverts.push(function(){i.parentNode.removeChild(i),p.parentNode.replaceChild(o,p),d.parentNode.removeChild(d),g.parentNode.replaceChild(a,g)}),g}},s}();